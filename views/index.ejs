<!-- server/views/index.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyApp</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <style>
    *{
      font-family: cursive;
    }
    body {
      margin: 0%;
      font-family: cursive;
    }

    .material-symbols-outlined {
      cursor: pointer;
    }

    .masterContainer {
      display: grid;
      grid-template-columns: minmax(300px, 15%) auto;
      /* Two columns layout, first column takes the remaining space */
      height: 100vh;
      /* Set the height of the grid to the full viewport height */
    }

    .sidebar {
      width: 100%;
      /* Full width of the sidebar */
      min-width: 100px;
      /* Set the minimum width */
      height: 100vh;
      /* Full height of the screen */
      padding: 10px;
      box-sizing: border-box;
      background-color: #f8fffc;
    }

    .mainContainer {
      width: 100%;
      /* Full width of the mainContainer */
      height: 100vh;
      /* Full height of the screen */
      padding: 10px;
      box-sizing: border-box;
      /* background-color: blue; */
    }

    .MainHead {
      width: 100%;
      height: 50px;
      font-family: 'Croissant One', cursive;
      position: relative;
      display: flex;
      align-items: center;
      /* padding: 0px 20px 0px 20px; Adjust padding as needed */
    }

    .databases {
      width: 100%;
      height: 50px;
      font-family: 'Croissant One', cursive;
      position: relative;
      display: flex;
      align-items: center;
      /* padding: 0px 20px 0px 20px; Adjust padding as needed */
    }

    .collections {
      width: 100%;
      height: 50px;
      font-family: 'Croissant One', cursive;
      position: relative;
      display: flex;
      align-items: center;
    }

    .MainHead .left {
      margin-left: auto;
      /* Align the span to the right */
    }

    .databases .left {
      margin-left: auto;
      /* Align the span to the right */
    }

    .collections .left {
      margin-left: auto;
      /* Align the span to the right */
    }

    .modal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50%;
      min-width: 500px;
      background-color: white;
      z-index: 3;
      border-radius: 20px;
    }

    .modal-content {
      padding: 20px;
    }

    .modal .body {
      /* position: relative; */
      /* display: flex; */
      /* align-items: center; */
      margin-top: 10px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .input input {
      margin-top: 5px;
      width: 100%;
      border-radius: 10px;
      font-size: 25px;
      border-width: 1px;
    }

    .input {
      margin-top: 15px;
    }

    .input button{
      padding: 10px;
      box-sizing: border-box;
      border-radius: 10px;
      border-width: 1px;
      cursor: pointer;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
      z-index: 2;
  }
  </style>


</head>

<body>
  <div class="masterContainer">
    <div class="sidebar">
      <div class="MainHead">
        <span class="material-symbols-outlined">
          database
        </span>
        DataBases
        <div class="left">
          <span class="material-symbols-outlined left" id="fetchDatabase">
            refresh
          </span>
          <span class="material-symbols-outlined left" id="openModalBtn">
            add
          </span>
        </div>

      </div>
      <div class="allDatabases" id="allDatabases">




      </div>

    </div>
    <div class="mainContainer">

    </div>
  </div>


  <!-- <button id="openModalBtn">Open Modal</button> -->
  <div class="overlay" id="overlay"></div>

  <div class="modal" id="myModal">
    <div class="modal-content">
      <div class="modal-head collections">
        <!-- Create Database<span class="close" id="closeModalBtn">&times;</span> -->
        <h1 id="modalHead">Create Database</h1>
        <div class="left">
          <span class="close" id="closeModalBtn">&times;</span>

        </div>
      </div>
      <div class="body">

        <div class="input">
          <label for="newDatabaseNAme">Database Name</label>
          <br>
          <input type="text" id="newDatabaseName">
        </div>

        <div class="input">
          <label for="newCollectionName">Collection Name</label>
          <br>
          <input type="text" id="newCollectionName">
        </div>

        <div class="input">
          <button style="float:right;margin-right: 0px; background-color: green;color: white;" id="createDatabase">
            Create Database
        </button>
          <button style="float:right; margin-right: 10px;" onclick="$('#closeModalBtn').click()">
              Cancel
          </button>
          
      </div>
      
        <br>

      </div>
    </div>
  </div>

  <script>
    function setDatabase() {

    }

    function showCollectionInSideBar(id, selfele) {
      // console.log(id)
      let ele = document.getElementById(`collectionDiv${id}`);
      // Make an AJAX request using jQuery
      if (ele.style.display == "") {
        ele.style.display = "none";
        selfele.innerHTML = "chevron_right";
      } else {
        $.ajax({
          url: 'http://localhost:3000/getCollectionByDatabaseSidebarPage',
          type: 'POST',
          data: { dbname: id }, // This will send data in the request body
          success: function (data) {
            // console.log(data);
            document.getElementById(`collectionDiv${id}`).innerHTML = data;
            ele.style.display = "";
            selfele.innerHTML = "expand_more";
          },
          error: function (xhr, status, error) {
            console.error('Error:', status, error);
          }
        });

      }



      // ele.style.display = (ele.style.display == "") ? "none" : "";
      //  = (ele.style.display != "") ? "chevron_right" : "expand_more";
    }



    $(document).ready(function () {
      // Attach a click event to the button

      // Make an AJAX request using jQuery
      $('#fetchDatabase').click(function () {
        $.ajax({
          url: 'http://localhost:3000/getAllDatabaseListSidebarPage',  // Replace with your server-side endpoint
          type: 'GET',
          success: function (data) {
            // Handle the successful response
            $('#allDatabases').html(data);
            // console.log(data);
            // console.log('database fetch successfulyy');
          },
          error: function (xhr, status, error) {
            // Handle errors
            console.error('Error:', status, error);
          }
        });

      })

      $('#createDatabase').click(function () {
        let databaseName=$("#newDatabaseName").val()
        let collectionName=$("#newCollectionName").val()
        $.ajax({
          url: 'http://localhost:3000/createDatabaseAndCollection',  // Replace with your server-side endpoint
          type: 'POST',
          data: {dbname:databaseName,collectionname:collectionName},
          success: function (data) {
            // Handle the successful response
            // $('#allDatabases').html(data);
            // console.log(data);
            // console.log('database fetch successfulyy');
            modal.css('display', 'none');
            overlay.css('display', 'none');
            $('#fetchDatabase').click();
          },
          error: function (xhr, status, error) {
            // Handle errors
            console.error('Error:', status, error);
          }
        });

      })

      document.getElementById('fetchDatabase').click();
        var openModalBtn = $('#openModalBtn');
        var closeModalBtn = $('#closeModalBtn');

        var modal = $('#myModal');
        var overlay = $('#overlay');
        
        // var modalHead= $('#modalHead')

        openModalBtn.on('click', function () {
          document.getElementById('modalHead').innerHTML="Create Database";
          modal.css('display', 'block');
          overlay.css('display', 'block');
          
        });

        closeModalBtn.on('click', function () {
          modal.css('display', 'none');
          overlay.css('display', 'none');
        });

        // Close the modal if the user clicks outside the modal content
        $(window).on('click', function (event) {
          if (event.target === modal[0]) {
            modal.css('display', 'none');
            overlay.css('display', 'none');
          }
        });

        

      });

      function openCollectionModal(database){
        var modal = $('#myModal');
        var overlay = $('#overlay');
          document.getElementById('modalHead').innerHTML="Create Collection";
          $("#newDatabaseName").val(database)
          modal.css('display', 'block');
          overlay.css('display', 'block');
        }

      

      


    document.addEventListener('DOMContentLoaded', function () {

    });

  </script>
</body>

</html>